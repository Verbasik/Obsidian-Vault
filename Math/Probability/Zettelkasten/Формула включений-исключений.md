## Суть

**Формула включений-исключений** — это формула для вычисления вероятности объединения событий через вероятности всех возможных пересечений.

Для двух событий: $$ P(A \cup B) = P(A) + P(B) - P(A \cap B) $$

Для трёх событий: $$ P(A \cup B \cup C) = P(A) + P(B) + P(C) - P(AB) - P(AC) - P(BC) + P(ABC) $$

Общая формула для n событий учитывает все комбинации пересечений с чередующимися знаками.

---

## Детали

### Формула для двух событий

**Утверждение**: $$ P(A \cup B) = P(A) + P(B) - P(A \cap B) $$

**Доказательство**: Представим $A \cup B$ как объединение непересекающихся частей: $$ A \cup B = A \cup (B \setminus A) $$

По аддитивности: $$ P(A \cup B) = P(A) + P(B \setminus A) $$

Теперь заметим, что $B = (A \cap B) \cup (B \setminus A)$ (непересекающиеся): $$ P(B) = P(A \cap B) + P(B \setminus A) $$

Откуда $P(B \setminus A) = P(B) - P(A \cap B)$.

Подставляя: $$ P(A \cup B) = P(A) + P(B) - P(A \cap B) $$

**Интерпретация**: При сложении P(A) + P(B) пересечение $A \cap B$ учитывается дважды, поэтому его нужно вычесть один раз.

### Формула для трёх событий

**Утверждение**: $$ P(A \cup B \cup C) = P(A) + P(B) + P(C) - P(AB) - P(AC) - P(BC) + P(ABC) $$

где $AB = A \cap B$, $ABC = A \cap B \cap C$.

**Структура**:

- **Сложить** все одиночные вероятности;
- **Вычесть** все парные пересечения;
- **Прибавить** тройное пересечение.

### Общая формула для n событий

Для событий $A_1, A_2, \ldots, A_n$: $$ P\left(\bigcup_{i=1}^n A_i\right) = \sum_{k=1}^n (-1)^{k+1} S_k $$

где $S_k$ — сумма вероятностей всех k-кратных пересечений: $$ S_k = \sum_{1 \leq i_1 < \cdots < i_k \leq n} P(A_{i_1} \cap \cdots \cap A_{i_k}) $$

**Явно**: $$ S_1 = \sum_{i=1}^n P(A_i) $$ $$ S_2 = \sum_{1 \leq i < j \leq n} P(A_i \cap A_j) $$ $$ S_3 = \sum_{1 \leq i < j < k \leq n} P(A_i \cap A_j \cap A_k) $$ и т.д.

### Обозначения

Часто используют краткие обозначения:

- $AB = A \cap B$;
- $ABC = A \cap B \cap C$;
- $S_1, S_2, S_3, \ldots$ — суммы вероятностей пересечений.

### Комбинаторная интерпретация

Число слагаемых в $S_k$ равно $\binom{n}{k}$ — число способов выбрать k событий из n.

Общее число слагаемых в формуле: $$ \sum_{k=1}^n \binom{n}{k} = 2^n - 1 $$

### Частные случаи

**Несовместные события**: Если $A_i \cap A_j = \emptyset$ для всех $i \neq j$, то все $S_k = 0$ при $k \geq 2$, и формула сводится к: $$ P(A_1 \cup \cdots \cup A_n) = P(A_1) + \cdots + P(A_n) $$

**Независимые события**: Формула сохраняет общий вид, но вероятности пересечений факторизуются: $$ P(A_i \cap A_j) = P(A_i) \cdot P(A_j) $$

---

## Примеры

**Пример 1**: Бросок кости (два события)

$A = {1, 2, 3}$ (число $\leq 3$), $P(A) = 1/2$

$B = {2, 4, 6}$ (четное), $P(B) = 1/2$

$A \cap B = {2}$, $P(A \cap B) = 1/6$

По формуле: $$ P(A \cup B) = 1/2 + 1/2 - 1/6 = 5/6 $$

Проверка: $A \cup B = {1, 2, 3, 4, 6}$, действительно $P(A \cup B) = 5/6$ ✓


**Пример 2**: Три события на кости

$A = {1, 2}$, $P(A) = 1/3$

$B = {2, 3}$, $P(B) = 1/3$

$C = {3, 4}$, $P(C) = 1/3$

Пересечения:

- $AB = {2}$, $P(AB) = 1/6$
- $AC = \emptyset$, $P(AC) = 0$
- $BC = {3}$, $P(BC) = 1/6$
- $ABC = \emptyset$, $P(ABC) = 0$

По формуле: $$ P(A \cup B \cup C) = \frac{1}{3} + \frac{1}{3} + \frac{1}{3} - \frac{1}{6} - 0 - \frac{1}{6} + 0 = 1 - \frac{1}{3} = \frac{2}{3} $$

Проверка: $A \cup B \cup C = {1, 2, 3, 4}$, действительно $P = 4/6 = 2/3$ ✓


**Пример 3**: Выбор карты

Из колоды извлекают одну карту. Найти вероятность, что это туз, король или черва.

$A$ = «туз» (4 карты), $P(A) = 4/52$

$B$ = «король» (4 карты), $P(B) = 4/52$

$C$ = «черва» (13 карт), $P(C) = 13/52$

Пересечения:

- $AB = \emptyset$ (не бывает туз-король), $P(AB) = 0$
- $AC = {$туз червей$}$, $P(AC) = 1/52$
- $BC = {$король червей$}$, $P(BC) = 1/52$
- $ABC = \emptyset$, $P(ABC) = 0$

По формуле: $$ P(A \cup B \cup C) = \frac{4 + 4 + 13}{52} - \frac{0 + 1 + 1}{52} + 0 = \frac{19}{52} $$

**Пример 4**: Четыре события

$A_1, A_2, A_3, A_4$ — четыре события.

Формула включений-исключений: $$ P\left(\bigcup_{i=1}^4 A_i\right) = S_1 - S_2 + S_3 - S_4 $$

где:

- $S_1 = P(A_1) + P(A_2) + P(A_3) + P(A_4)$ (4 слагаемых);
- $S_2 = P(A_1A_2) + P(A_1A_3) + \cdots$ ($\binom{4}{2} = 6$ слагаемых);
- $S_3 = P(A_1A_2A_3) + \cdots$ ($\binom{4}{3} = 4$ слагаемых);
- $S_4 = P(A_1A_2A_3A_4)$ (1 слагаемое).

Всего: $4 + 6 + 4 + 1 = 15$ слагаемых

---

## Источник

- Документ: [[Вероятность.pdf]]
- Раздел/страницы: § 1, Задача 5, стр. 37-38
- Ключевая цитата (формула 7, стр. 33):
    
    > «$P(A \cup B) = P(A) + P(B) - P(A \cap B)$».
    

---

## Вопросы

- Почему знаки чередуются (+, -, +, -, ...)?
- Как запомнить формулу для большого числа событий?
- Когда формула включений-исключений проще прямого подсчёта?
- Существуют ли более эффективные алгоритмы вычисления для специальных случаев?